<div class="module">
  <div class="container-fluid">
    <div class="module-heading">
      Concept editor : {{concept?.context}}
        <div class="pull-right">
          <button class="btn btn-danger" (click)="close(true)">Close</button>
        </div>
    </div>
    <div class="module-body">
      <form>
        <div class="row">
          <div class="col-md-6"><div class="row h-100">
          <div class="col-md-12 mb-4">
                <div class="card h-100" id="detailCard" *ngIf="concept">
                  <div class="card-header">
                    <h4>Details
                      <div class="pull-right">
                        <button class="btn btn-success" (click)="saveConcept(false)">Save</button>
                        <button class="btn btn-danger" (click)="promptDeleteConcept()">Delete</button>
                      </div>
                    </h4>
                  </div>
                  <div class="card-body">
                    <div class="row" *ngIf="concept">
                      <div class="col-md-6 col-lg-3 form-group">
                        <label class="control-label" for="conceptShortName">Short name</label>
                        <input class="form-control" id="conceptShortName" type="text" [(ngModel)]="concept.shortName" name="conceptShortName">
                      </div>
                      <div class="col-md-6 col-lg-3 form-group">
                        <label class="control-label" for="conceptSuperclass"><a href="#/concept/{{concept.superclass.id}}">Subtype of</a></label>
                        <div class="input-group">
                          <input class="form-control" id="conceptSuperclass" type="text" value="{{concept.superclass.name}}" name="conceptSuperclass" readonly>
                          <div class="input-group-append" (click)="promptSuperclass()"><span class="input-group-text"><i class="fa fa-fw fa-search"></i></span></div>
                        </div>
                      </div>
                      <div class="col-md-6 col-lg-2 form-group">
                        <label class="control-label" for="conceptStatus">Status</label>
                        <div class="dropdown" id="conceptStatus">
                          <button class="dropdown-toggle btn-block text-left form-control" id="statusDropdown" type="button" data-toggle="dropdown">{{getConceptStatusName(concept.status)}}<i class="fa fa-caret-down pull-right"></i> </button>
                          <div class="dropdown-menu"  aria-labelledby="statusDropdown">
                            <button class="dropdown-item" (click)="concept.status = (ConceptStatus.DRAFT)">Draft</button>
                            <button class="dropdown-item" (click)="concept.status = (ConceptStatus.ACTIVE)">Active</button>
                            <button class="dropdown-item" (click)="concept.status = (ConceptStatus.DEPRECATED)">Deprecated</button>
                            <button class="dropdown-item" (click)="concept.status = (ConceptStatus.TEMPORARY)">Temporary</button>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3 col-lg-2 form-group">
                        <label class="control-label" for="conceptVersion">Version</label>
                        <input class="form-control" id="conceptVersion" type="text" value="{{concept.version}}" name="conceptVersion" readonly>
                      </div>
                      <div class="col-md-3 col-lg-2 form-group">
                        <label class="control-label" for="conceptUses">Use count</label>
                        <input class="form-control" id="conceptUses" type="text" value="{{concept.useCount}}" name="conceptUses" readonly>
                      </div>
                      <div class="col-md-12 col-lg-10 form-group">
                        <label class="control-label" for="conceptName">Full name</label>
                        <input class="form-control" id="conceptName" type="text" [(ngModel)]="concept.fullName" name="conceptName">
                      </div>
                      <div class="col-md-3 col-lg-2 form-group">
                        <label class="control-label" for="conceptSynonyms">{{synonyms?.length}} Synonyms</label>
                        <span class="form-control btn-success" id="conceptSynonyms" name="conceptSynonyms" (click)="editSynonyms()">View / Edit...</span>
                      </div>
                      <div class="col-md-12 col-lg-12 form-group">
                        <label class="control-label" for="conceptUrl">URL</label>
                        <input class="form-control" id="conceptUrl" type="text" [(ngModel)]="concept.url" name="conceptUrl" >
                      </div>
                      <div class="col-md-12 col-lg-12 form-group">
                        <label class="control-label" for="conceptDescription">Description</label>
                        <textarea rows="1" class="form-control" id="conceptDescription" type="text" [(ngModel)]="concept.description" name="conceptDescription"></textarea>
                      </div>
                    </div>
                  </div>
                </div>
          </div>
          <div class="col-md-12 mb-4">
            <div class="card h-100" id="relatedGraph">
              <div class="card-header"><h4>Diagram<small> (double-click to expand)</small><button class="btn btn-info pull-right" (click)="zoom()">Visualize</button></h4></div>
              <div class="card-body">
                <nodeGraph #nodeGraph (nodeClick)="nodeClick($event)" (nodeDblClick)="nodeDblClick($event)" ></nodeGraph>
              </div>
            </div>
          </div>
          </div></div>
          <div class="col-md-6 mb-4">
            <div class="card h-100" id="attributeCard" *ngIf="attributes">
              <div class="card-header"><h4>Properties
<!--                <small class="text-center w-100">
                  <span class="col-md-2"><i class="text-info fa fa-fw fa-circle"></i> = Unchanged</span>
                  <span class="col-md-2"><i class="text-success fa fa-fw fa-plus-circle"></i> = Extends</span>
                  <span class="col-md-2"><i class="text-warning fa fa-fw fa-minus-circle"></i> = Constrains</span>
                </small>-->
                <button class="btn btn-success pull-right" (click)="addAttribute()" [disabled]="concept.id == null">Add</button>
              </h4> </div>
              <div class="card-body">
                <div class="row mb-4">
                  <div class="col-md-2"><i class="text-info fa fa-fw fa-circle"></i> = Unchanged</div>
                  <div class="col-md-2"><i class="text-success fa fa-fw fa-plus-circle"></i> = Extends</div>
                  <div class="col-md-2"><i class="text-warning fa fa-fw fa-minus-circle"></i> = Constrains</div>
                </div>
                <div class="row">
                  <div class="col-md-12 form-group">
                    <div class="scroll-box" style="height: 650px">
                      <table class="table table-striped table-sm table-hover">
                        <thead>
                          <tr>
                            <th>Property</th>
                            <th></th>
                            <th>Type</th>
                            <th>Value</th>
                            <th style="width: 75px"></th>
                          </tr>
                        </thead>
                        <tbody>
                          <ng-container *ngFor="let item of attributes; let i = index;">
                            <tr *ngIf="item.concept.id != concept.id && (i==0 || item.concept.id != attributes[i-1].concept.id)">
                              <th colspan="5">From <a href="#/concept/{{item.concept.id}}">{{item.concept.name}}</a></th>
                            </tr>
                            <tr class="show-child-on-hover" [ngClass]="{'selection': selectedNode == item}" (click)="selectedNode = item">
                            <td>
                              <i [class]="getInheritanceIcon(item.inheritance)"></i>
                              <a href="#/concept/{{item.attribute.id}}">{{item.attribute.name}}</a>
                            </td>
                              <td>
                                {{getCardinality(item.mandatory, item.limit)}}
                              </td>
                            <td>
                              <span *ngIf="item.valueExpression != null">{{getValueExpressionPrefix(item.valueExpression)}}</span>
                              <a href="#/concept/{{item.valueConcept.id}}" *ngIf="item.valueConcept">{{item.valueConcept.name}}</a>
                            </td>
                            <td>
                              <span *ngIf="item.fixedConcept"><a href="#/concept/{{item.fixedConcept.id}}">{{item.fixedConcept.name}}</a></span>
                              <span *ngIf="!item.fixedConcept">{{item.fixedValue}}</span>
                            </td>
                            <td style="width: 75px">
                              <div class="pull-right child-to-show">
                                <button class="btn btn-xs btn-success" (click)="editAttribute(item)"><i class="fa fa-fw fa-pencil"></i></button>
                                <button class="btn btn-xs btn-danger" (click)="promptDeleteAttribute(item)" [disabled]="item.concept.id != concept.id"><i class="fa fa-fw fa-trash"></i></button>
                              </div>
                            </td>
                          </tr>
                          </ng-container>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
<!--
          <div class="col-md-6 mb-4">
            <div class="card h-100" id="relatedCard" *ngIf="related">
              <div class="card-header"><h4>Related concepts <button class="btn btn-success pull-right" (click)="addRelated()">Add</button></h4> </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-12">
                    <div>
                      <table class="table table-striped table-sm table-hover">
                        <thead>
                          <tr class="d-flex">
                            <th class="col-4">Relationship</th>
                            <th class="col-3"></th>
                            <th class="col-4"></th>
                            <th class="col-1"></th>
                          </tr>
                        </thead>
                        <tbody class="d-block scroll-box-250">
                          <tr class="d-flex show-child-on-hover" *ngFor="let item of related" [ngClass]="{'selection': selectedNode == item}" (click)="selectedNode = item">
                            <td class="col-4">
                              <a href="#/concept/{{item.source.id}}" *ngIf="item.source.id != concept.id">{{item.source.name}}</a>
                              <span *ngIf="item.source.id == concept.id">{{item.source.name}}</span>
                            </td>
                            <td class="col-3">{{item.relationship.name}} {{getCardinality(item.mandatory, item.limit)}}</td>
                            <td class="col-4">
                              <a href="#/concept/{{item.target.id}}" *ngIf="item.target.id != concept.id">{{item.target.name}}</a>
                              <span *ngIf="item.target.id == concept.id">{{item.target.name}}</span>
                            </td>
                            <td class="col-1">
                              <div class="pull-right child-to-show">
                                <button class="btn btn-xs btn-success" (click)="editRelated(item)"><i class="fa fa-fw fa-pencil"></i></button>
                                <button class="btn btn-xs btn-danger" (click)="deleteRelated(item)"><i class="fa fa-fw fa-trash"></i></button>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
-->
        </div>
      </form>
    </div>
  </div>
</div>
